<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentCar - Réservation & Panier</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* ================= CSS (STYLE) ================= */
        
        /* 1. RESET ET BASE */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: #f7f7f7; color: #222; padding-bottom: 50px; }

        /* 2. NAVIGATION */
        nav {
            background: white;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .logo { font-size: 1.5rem; font-weight: bold; color: #ff385c; text-decoration: none; }

        /* Style du Panier dans le menu */
        .cart-icon-container {
            position: relative;
            cursor: pointer;
            padding: 10px;
        }
        
        .cart-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #ff385c;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            height: 20px;
            width: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid white;
            transition: transform 0.2s;
        }

        /* Animation quand on ajoute un article */
        .bump { animation: bump 0.3s ease-out; }
        @keyframes bump { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }

        /* 3. GRILLE DE VOITURES */
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        h1 { margin-bottom: 25px; font-size: 1.8rem; }

        .cars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        /* 4. CARTE VOITURE */
        .car-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #eee;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .car-image {
            width: 100%; height: 200px; position: relative;
        }
        
        .car-image img {
            width: 100%; height: 100%; object-fit: cover;
        }

        .car-details { padding: 15px; }

        .car-header {
            display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px;
        }
        
        .car-title { font-size: 1.1rem; font-weight: 700; }
        .car-rating { font-size: 0.9rem; }
        .car-rating i { color: #ff385c; }
        
        .car-location { color: #717171; font-size: 0.9rem; margin-bottom: 12px; }

        /* Caractéristiques (icones) */
        .car-features {
            display: flex; gap: 10px; margin-bottom: 15px;
        }
        .feature {
            background-color: #f3f3f3; padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; color: #555;
        }

        /* Pied de la carte (Prix + Bouton) */
        .car-footer {
            display: flex; justify-content: space-between; align-items: center; margin-top: 15px; pt: 15px; border-top: 1px solid #eee;
        }

        .price { font-size: 1.2rem; font-weight: bold; }
        .price span { font-size: 0.9rem; font-weight: normal; color: #717171; }

        /* BOUTON AJOUTER */
        .btn-add {
            background-color: #ff385c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-add:hover { background-color: #d9324e; }
        .btn-add:active { transform: scale(0.95); }

        /* Responsive Mobile */
        @media (max-width: 600px) {
            nav { padding: 15px 20px; }
            .cars-grid { grid-template-columns: 1fr; } 
        }
    </style>
</head>
<body>

    <nav>
        <a href="#" class="logo">RentCar</a>

        <div class="cart-icon-container" onclick="voirPanier()">
            <i class="fas fa-shopping-cart" style="font-size: 22px; color: #333;"></i>
            <span id="cart-count" class="cart-badge">0</span>
        </div>
    </nav>

    <div class="container">
        <h1>Véhicules disponibles</h1>

       <div class="cars-grid">

    <div th:each="v : ${voitures}" class="car-wrapper">

        <!-- Carte cliquable pour aller à la description -->
        <a th:href="@{'/voiture/' + ${v.voiture_id}}" 
           style="text-decoration:none; color:inherit; display:block;">

            <div class="car-card">

                <div class="car-image">
                    <img th:src="${v.image_url}" th:alt="${v.marque}">
                </div>

                <div class="car-details">

                    <div class="car-header">
                        <div class="car-title" 
                             th:text="${v.marque} + ' ' + ${v.modele}"></div>
                        <div class="car-rating"><i class="fas fa-star"></i> 4.5</div>
                    </div>

                    <div class="car-location">Disponible maintenant</div>

                    <div class="car-features">
                        <span class="feature">
                            <i class="fas fa-gas-pump"></i>
                            <span th:text="${v.carburant}"></span>
                        </span>
                        <span class="feature"><i class="fas fa-cog"></i> Auto</span>
                    </div>

                    <div class="car-footer">
                        <div class="price">
                            <span th:text="${v.prix_par_jour} + ' DH'"></span>
                            <span>/jour</span>
                        </div>
                    </div>

                </div>

            </div>
        </a>

        <!-- BOUTON RÉSERVER (EN DEHORS DU LIEN POUR NE PAS REDIRIGER) -->
        <button type="button" class="btn-add"
        th:attr="data-id=${v.voiture_id}">
    Réserver
</button>

    </div>

</div>

      

    </div>

  <script>
let panier = JSON.parse(localStorage.getItem('monPanier')) || [];

const badgeCount = document.getElementById('cart-count');
const buttons = document.querySelectorAll('.btn-add');

function updateCartUI() {
    badgeCount.innerText = panier.length;
    badgeCount.classList.remove('bump');
    void badgeCount.offsetWidth;
    badgeCount.classList.add('bump');
}

updateCartUI();

buttons.forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.stopPropagation(); // empêche d’ouvrir la carte
        e.preventDefault();

        const voitureId = this.getAttribute('data-id');

        // Redirection vers la page de description
        window.location.href = "/voiture/" + voitureId;
    });
});

</script>


</body>
</html>